services:
  artgallery-server:
    build:
      context: .
      dockerfile: Dockerfile
    image: artgallery-server:dev
    container_name: artgallery-server
    ports: ["8080:8080"]
    environment:
      ASPNETCORE_ENVIRONMENT: "Development"
      ASPNETCORE_URLS: "http://0.0.0.0:8080"
      ConnectionStrings__Default: "Data Source=/data/app.db;Cache=Shared;Pooling=True"
      ADMIN_USERNAME: "admin"
      ADMIN_PASSWORD: "password"
      JWT_KEY: "11609a16ac5035ea2190156b4f5af37f1fb3c922082905744eeca49da3d36319f943c38fc61b7175f0d622db0248d9e0cd101d3c0252be4efec3fefda58e4477"
      APPLY_MIGRATIONS: "true"
    volumes:
      - app_data:/data
      - ./wwwroot:/app/wwwroot:rw
    user: "0:0"
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "wget -qO- http://localhost:8080/healthz || exit 1"]
      interval: 10s
      timeout: 3s
      retries: 5

volumes:
  app_data: {}
  art_wwwroot: